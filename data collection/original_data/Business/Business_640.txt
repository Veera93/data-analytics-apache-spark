 The path to fast and affordable online grocery service is littered with obstacles: refrigeration challenges, storage woes and high transportation costs, among others. But the country’s largest retailers are convinced that it will lead to a lucrative and largely untapped market. And they are all rushing to dominate it first. Walmart escalated the competition on Wednesday by announcing plans to expand its online grocery delivery service to 100 metropolitan areas by the end of the year. Orders will be fulfilled at more than 800 stores nationwide and shuttled to shoppers by drivers contracted through Uber, Deliv and other ride and delivery platforms. Customers must order at least $30 worth of goods and pay an additional delivery fee of $9.95; they can receive their purchases in as little as four hours if they put in the request by 1 p.m. The plan puts the world’s largest retailer on a direct collision course with the world’s most powerful e-commerce player, Amazon, which purchased the Whole Foods grocery chain for $13.4 billion last summer and recently announced plans to use those stores to fill on-demand orders. Other retailers like Costco, Target and Kroger are also joining the increasingly expensive battle for customers who want eggs and milk without leaving their couch. “There is a lot of experimenting going on as everyone tries to figure out that last-mile delivery — it’s a tough economic equation to make work,” said Mike Knemeyer, a professor of logistics at Ohio State University. “But if you can, you’ll have a big head start on the others, and you’ll end up making money not just in groceries but on all of the things that you sell.” The nexus of e-commerce and grocery sales is increasingly appealing to retailers. “The thing that’s great about grocery is that it’s a pure traffic driver — no matter who you are, you need to get groceries every two weeks, which makes it an exception from all the other categories that keep retailers up at night,” said Matt Sargent, a retail expert at the consulting firm Magid. But while the total grocery market is enormous — nearly $1 trillion annually in the United States — many customers still insist on seeing and touching their food in person before buying. Spending on online groceries is currently just $27 billion a year, or 3 percent of the total, according to Forrester Research, which specializes in technology. Controlling costs is another major challenge. Grocery providers have grappled with the expense of packaging delicate produce and meats in ice packs and dispatching fleets of company-owned vehicles from distribution centers staffed around the clock. Even Amazon has struggled. The company launched its AmazonFresh service in the Seattle area in 2007 and tested it for years before expanding it to more than 20 cities. Customers pay $14.99 a month — in addition to their $99-a-year Prime membership — to have groceries sent directly to them. But late last year, the company decided to pull AmazonFresh from some markets. “There’s no question that online grocery has been a challenge for everyone, including Amazon,” said Sucharita Kodali, an analyst at Forrester. “The reason is it’s just really, really hard to get the last mile going.” But Amazon touched off a flurry of activity with its acquisition of Whole Foods in June. In October, Costco introduced a two-day delivery option for dry groceries and a same-day program for fresh goods through Instacart, a delivery service. Target said in December that it would purchase the online same-day delivery service Shipt for $550 million in cash. Amazon, which has several brick-and-mortar grocery options in Seattle, said this month that it had begun to offer same-day delivery of groceries from Whole Foods in six cities and would expand the program to the rest of the country later this year. The program is run through Amazon’s Prime Now service, which relies on contractors to make deliveries in their personal cars within two hours of an order being placed. The service is free to Prime customers, but Amazon automatically adds an optional tip. Kroger soon followed Amazon’s lead with an announcement that it would expand the number of cities eligible for home delivery of groceries through Instacart. Walmart’s Sam’s Club division, which said last month it would offer members free shipping of online orders for an annual $100 fee, also uses Instacart. But Walmart said that it would not tap Instacart for the grocery delivery program at its Walmart stores, which it said would reach more than 40 percent of American households. “We’re saving customers time by leveraging new technology, and connecting all the parts of our business into a single seamless shopping experience: great stores, easy pickup, fast delivery, and apps and websites that are simple to use,” Greg Foran, the chief executive of Walmart U.S., said in a statement. The company has made substantial investments in its growing suite of online offerings, including a partnership with Google to sell Walmart products on Google Express and the creation of Store No. 8, an internal venture to help develop new online businesses. In the fall, Walmart bought Parcel, a 24-hour delivery service that uses algorithms and leased vehicles to send perishable and nonperishable products to customers in New York City. On Wednesday, Walmart also reiterated that it planned to expand its curbside grocery pickup service to 1,000 more locations this year, in addition to the 1,200 locations where it is already offered. The service allows customers to order food online and collect it at Walmart stores. But Walmart’s e-commerce success has sometimes been fickle — its online sales increased 23 percent in its most recent quarter, less than half the rate of growth in each of the previous three quarters and a performance that sent a ripple of nervousness through the stock market. Walmart’s expanded delivery service requires that customers visit the company’s website or grocery app to place orders. The chain will then have one of its 18,000 personal shoppers collect the selected items in stores. Each of those employees — along with the thousands more that Walmart said it would add this year — undergoes a three-week training program that teaches them how to pick the best meats and produce. As specialists, they are paid more than the company’s entry-level workers. Beefing up its grocery delivery service is an “informed gamble” for Walmart, Mr. Knemeyer said — one that will most likely serve up side benefits such as data collection and inroads with young, affluent city dwellers. The chain, long known as a discount retailer, has lately been trying to broaden its appeal. It spent $3.3 billion acquiring Jet.com, a bulk online retailer that Walmart said would give it access to “urban and millennial customers.” In 2017, it purchased the hip e-commerce brands Bonobos and ModCloth. Last month, it unveiled what it called an “Instagram-worthy” collection of mattresses and bedding, available through a separate website. But the supercenters for which Walmart is best known tend to exist on the outskirts of cities and in rural areas. Breaking into metropolitan grocery ecosystems, which often support an already robust network of delivery services for grocery chains and restaurants alike, could be difficult, experts said. And the feature of groceries that make them so attractive to retailers — they are regularly consumed and so must be regularly replenished — makes most consumers unwilling to splurge on them. Walmart’s $9.95 fee on each order is a much more visible cost to consumers compared to Amazon’s annual $99 fee for its Prime membership, which many shoppers set to auto-pay and then forget. “They probably just look at the relatively high delivery fee and get scared off,” said Matthias Winkenbach, director of M.I.T.’s Megacity Logistics Lab. “Walmart would have to do a very good job communicating the overall economics of shopping their everyday low prices versus Amazon.”